@(movies: List[Movie])

@ratingMatch(m: Movie, rate: Int, s: String) = {
  @m.ratingMatch(Long.parseLong(session().get("id"), 10), rate, s)
}

<div class="well well-sm">
  <div class="container">
    <ul class="nav nav-pills">
      <li><a href="/home">Home</a></li>
      <li class="active"><a href="/movie">Movies</a></li>
      <li><a href="#">Recomender</a></li>
      <li class="pull-right"><a href="/logout">Logout</a></li>
    </ul>
  </div>
</div>
<div class="container">
  <form action="/movie/search/page/1" method="GET">
    <div class="form-group">
      <div class="input-group">
        <input name="search" type="text" class="form-control" placeholder="Search movies..">
        <span class="input-group-btn">
          <button class="btn btn-default" type="submit">
            <span class="glyphicon glyphicon-search"></span>
          </button>
        </span>
      </div>
    </div>
  </form>
  <div class="panel panel-default">
    @if(movies == null || movies.isEmpty()) {
      <div class="panel-body">
        Nothing to display.
      </div>
    } else {
      <table class="table table-hover table-striped">
        <thead>
          <tr class="active">
            <th class="col-md-5">Movie Title</th>
            <th class="col-md-3">Genre</th>
            <th class="col-md-2">Release</th>
            <th class="col-md-2">Rating</th>
          </tr>
        </thead>
        <tbody>
          @for(movie <- movies) {
            <tr>
              <td>@movie.title</td>
              <td>
                @for(s <- movie.genre()) {
                  @s
                }
              </td>
              <td>@movie.release_date</td>
              <td>
                <div class="btn-group" data-toggle="buttons">
                  @for(i <- 1 to 5) {
                    <label class="btn btn-default btn-xs @ratingMatch(movie, i, "active")" onclick="rate(@movie.id, @i)">
                      <input type="radio" value="@i" @ratingMatch(movie, i, "checked")>@i
                    </label>
                  }
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    }
  </div>
</div>

<script>
  var user_id = @session().get("id");
  function rate(id, rating) {
    $.ajax({
      type: "GET",
      // dataType: "json",
      url: "/movie/rate",
      data: {
        item_id: id,
        rating: rating
      },
      success: function(data){
        alert(data);
      },
      error: function() {
        alert('unable to rate via ajax');
      }
    });
  }
  $(document).ready(function() {

  });
</script>
